<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIKE | Frutería & Jurisprudencia</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%23FF6B35'/><text x='50' y='75' font-family='Georgia, serif' font-weight='bold' font-style='italic' font-size='70' text-anchor='middle' fill='%230a0a0a'>P</text></svg>">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,400;1,600&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream': '#f2f0eb',
                        'black': '#0a0a0a',
                        'melon': '#FF6B35', 
                        'blood': '#4a0404'
                    },
                    fontFamily: {
                        'display': ['Syne', 'sans-serif'],
                        'serif': ['Playfair Display', 'serif'],
                    },
                    cursor: {
                        'none': 'none',
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE & RESET */
        body {
            background-color: #f2f0eb;
            color: #0a0a0a;
            cursor: none; 
            overflow-x: hidden;
            font-feature-settings: "ss01", "dlig";
        }

        /* CUSTOM CURSOR */
        #cursor {
            display: block; 
            pointer-events: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 20px;
            height: 20px;
            background-color: #FF6B35;
            border-radius: 50%;
            z-index: 9999;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s, background-color 0.3s;
            mix-blend-mode: difference;
        }
        #cursor.hovered {
            width: 80px;
            height: 80px;
            background-color: transparent;
            border: 2px solid #FF6B35;
        }

        /* DESACTIVAR CURSOR EN MÓVIL */
        @media (hover: none) and (pointer: coarse) {
            body { cursor: auto; }
            #cursor { display: none; }
        }

        /* TYPOGRAPHY UTILS */
        .text-giant {
            font-size: clamp(2.5rem, 13vw, 16rem);
            line-height: 0.85;
            letter-spacing: -0.03em;
            word-break: break-word; 
        }
        
        /* MARQUEE ANIMATION */
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
        }
        .marquee-content {
            display: inline-block;
            animation: scroll 20s linear infinite;
        }
        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* REVEAL ANIMATIONS */
        .reveal-text {
            opacity: 0;
            transform: translateY(60px);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .reveal-text.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* ACCORDION */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* SHAPES */
        .fruit-shape {
            border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
            animation: morph 8s ease-in-out infinite;
        }
        @keyframes morph {
            0%, 100% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
            34% { border-radius: 70% 30% 50% 50% / 30% 30% 70% 70%; }
            67% { border-radius: 100% 60% 60% 100% / 100% 100% 60% 60%; }
        }

        /* GRAIN OVERLAY */
        .grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        }

        /* SNOW CANVAS (Dynamic) */
        #snow-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9005; /* Above grain, below UI */
            opacity: 0;
            transition: opacity 1s ease;
        }
        #snow-canvas.active {
            opacity: 1;
        }
    </style>
</head>
<body class="antialiased selection:bg-melon selection:text-cream">

    <!-- Cursor -->
    <div id="cursor"></div>
    
    <!-- Grain Overlay -->
    <div class="grain"></div>

    <!-- 
      NEW FEATURE: CHRISTMAS MODE CONTROLS 
      Visible only on mobile (md:hidden).
      Positioned fixed top-right to be unobtrusive but accessible.
    -->
    <div id="christmas-controls" class="fixed top-24 right-4 z-[9999] md:hidden flex flex-col items-end gap-3 pointer-events-auto">
        
        <!-- Audio Button (Hidden by default) -->
        <button id="audio-btn" class="hidden font-display font-bold text-[10px] bg-black text-melon border border-melon px-3 py-1 uppercase tracking-widest shadow-lg active:scale-95 transition-all">
            ♪ SONIDO
        </button>

        <!-- Toggle Mode Button -->
        <button id="xmas-toggle" class="font-display font-bold text-[10px] bg-melon text-black border border-black px-3 py-1 uppercase tracking-widest shadow-lg active:scale-95 transition-all">
            ❄ SOLSTICIO PAGANO
        </button>
    </div>

    <!-- HIDDEN AUDIO SOURCE -->
    <audio id="bg-music" loop preload="auto">
        <source src="FlyingFree.mp3" type="audio/mpeg">
    </audio>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full p-6 md:p-8 flex justify-between items-center z-50 mix-blend-difference text-cream">
        <span class="font-display font-bold text-lg md:text-xl tracking-tighter">PIKE ©</span>
        <a href="#metodo" class="interactable font-serif italic text-base md:text-lg hover:underline decoration-melon decoration-2 underline-offset-4">La Trastienda</a>
    </nav>

    <!-- HERO SECTION -->
    <section class="flex flex-col h-auto md:min-h-screen md:justify-end relative overflow-hidden border-b border-black pt-20 md:pt-24 md:pb-20 md:px-12 bg-cream">
        
        <!-- Background Blob (Desktop Only) -->
        <div class="absolute top-1/4 right-0 w-[60vw] h-[60vw] bg-melon opacity-20 blur-[80px] md:blur-[100px] rounded-full pointer-events-none hidden md:block"></div>
        
        <!-- ========================================= -->
        <!-- ZONA DE IMAGEN SUPERIOR (SOLO MÓVIL)      -->
        <!-- ========================================= -->
        <div id="mobile-hero-container" class="relative w-full h-[50vh] md:hidden block z-0">
            
            <!-- Standard Image -->
            <img id="mobile-hero-img" 
                 src="pike-boss.jpg" 
                 alt="Pike Boss" 
                 class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500"
                 style="object-position: center 20%;"> 
            
            <!-- 
              Video injected dynamically via JS logic below
              to avoid loading overhead when not needed.
            -->
        </div>

        <!-- ========================================= -->
        <!-- ZONA DE TEXTO INFERIOR                    -->
        <!-- ========================================= -->
        <div class="flex flex-col justify-end px-5 pb-12 bg-cream md:bg-transparent md:px-0 md:pb-0 z-10 relative">
            
            <div class="mb-8 md:mb-12">
                <h1 class="font-display font-bold text-giant uppercase leading-[0.9] reveal-text break-words hyphens-auto relative text-black">
                    Ellas <br>
                    <span class="font-serif italic text-melon font-light block ml-4 md:ml-32">Confiesan.</span>
                    Yo Dicto <br> Sentencia.
                </h1>
            </div>

            <!-- Quote -->
            <div class="max-w-md ml-1 md:ml-12 mt-4 md:mt-8 reveal-text" style="transition-delay: 0.2s;">
                <div class="bg-cream md:bg-cream/90 md:backdrop-blur-sm p-4 rounded-sm inline-block border-l-4 border-melon">
                    <p class="font-serif italic text-lg md:text-2xl leading-tight pr-4 text-black font-medium">
                        "Lo que las mujeres susurran cuando creen que nadie escucha, 
                        filtrado por un abogado reformado que ahora pesa higos."
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- MARQUEE -->
    <section class="bg-black text-cream py-8 md:py-24 overflow-hidden rotate-1 mt-[-2px] relative z-20">
        <div class="marquee-container font-display font-bold text-5xl md:text-9xl uppercase tracking-tighter">
            <div class="marquee-content">
                 &nbsp;El Monstruo es necesario — No seas vainilla — Depravación Gourmet — Instinto vs. Ideología — El Monstruo es necesario — No seas vainilla — Depravación Gourmet — Instinto vs. Ideología
            </div>
            <div class="marquee-content" aria-hidden="true">
                 &nbsp;El Monstruo es necesario — No seas vainilla — Depravación Gourmet — Instinto vs. Ideología — El Monstruo es necesario — No seas vainilla — Depravación Gourmet — Instinto vs. Ideología
            </div>
        </div>
    </section>

    <!-- MANIFIESTO -->
    <section class="py-20 md:py-32 px-5 md:px-12 grid grid-cols-1 md:grid-cols-12 gap-8 md:gap-12 items-start relative z-10 bg-cream">
        <div class="absolute left-[-10%] top-[20%] w-[50vw] h-[40vh] bg-black fruit-shape opacity-5 z-0"></div>

        <div class="md:col-span-4 z-10 md:sticky md:top-32 reveal-text">
            <h2 class="font-display font-bold text-4xl md:text-7xl mb-4 md:mb-6 leading-none">EL JUEZ<br><span class="text-melon">DE LA FRUTA</span></h2>
            <div class="w-full h-[1px] bg-black mb-4 md:mb-6"></div>
            <p class="font-serif italic text-base md:text-lg opacity-70">Expediente Nº: 00-PIKE-24</p>
        </div>

        <div class="md:col-span-8 space-y-8 md:space-y-12 z-10 text-lg md:text-3xl font-light leading-snug reveal-text">
            <p>
                Cambié la toga por el delantal. Me di cuenta de que en los juzgados la gente miente bajo juramento, pero en mi frutería, <strong class="font-display font-bold text-melon interactable">mientras tocan los melones</strong>, confiesan sus pecados más oscuros.
            </p>
            <p>
                Vengo del mundo de las leyes, pero ahora aplico la ley de la selva. Escucho a tus novias, a tus esposas y a las que "no son nada tuyo". Me cuentan lo que falta en casa. Me hablan de ese vacío que no llena un ramo de rosas ni una cena en París.
            </p>
            <p class="font-serif italic border-l-4 border-melon pl-6 md:pl-8 text-xl md:text-3xl">
                "Buscan un roble, no una caña de bambú. Buscan un monstruo que las proteja del mundo, incluso de sí mismas."
            </p>
            <p>
                He decodificado sus instintos primitivos. Ellas viven en una disonancia cognitiva constante: su ideología pide igualdad, <strong class="font-display font-bold">pero su biología pide sentencia firme.</strong>
            </p>
        </div>
    </section>

    <!-- INSIGHTS (ACCORDION) -->
    <section class="min-h-screen bg-black text-cream px-5 md:px-12 py-20 md:py-32 relative z-10">
        <h3 class="font-display font-bold text-[15vw] md:text-[12vw] leading-none mb-12 md:mb-24 opacity-20 text-center select-none">EVIDENCIA</h3>

        <div class="max-w-4xl mx-auto space-y-0 border-t border-cream/30">
            
            <!-- Item 1 -->
            <div class="accordion-item border-b border-cream/30 group">
                <button class="w-full py-8 md:py-12 flex justify-between items-center text-left interactable focus:outline-none">
                    <div class="flex flex-col md:flex-row md:items-center">
                        <span class="font-serif italic text-melon text-lg md:text-2xl mb-2 md:mb-0 md:mr-4">Art. 1</span>
                        <h4 class="font-display font-bold text-2xl md:text-5xl uppercase group-hover:text-melon transition-colors pr-4">La paradoja de la bestia</h4>
                    </div>
                    <span class="text-3xl md:text-4xl font-light transform transition-transform duration-300 flex-shrink-0 group-hover:rotate-45">+</span>
                </button>
                <div class="accordion-content">
                    <div class="pb-8 md:pb-12 text-base md:text-xl font-light opacity-80 leading-relaxed max-w-2xl ml-auto">
                        <p class="mb-4 md:mb-6">
                            Ellas quieren un hombre peligroso, pero domesticado *solo* para ellas. Es la fantasía de "La Bella y la Bestia". Si eres inofensivo con el mundo, eres invisible para ella. 
                        </p>
                        <p>
                            <strong>El Veredicto de Pike:</strong> Tienes que ser capaz de destruir, pero elegir no hacerlo. Si no tienes colmillos, tu bondad no es virtud, es falta de opciones.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Item 2 -->
            <div class="accordion-item border-b border-cream/30 group">
                <button class="w-full py-8 md:py-12 flex justify-between items-center text-left interactable focus:outline-none">
                    <div class="flex flex-col md:flex-row md:items-center">
                        <span class="font-serif italic text-melon text-lg md:text-2xl mb-2 md:mb-0 md:mr-4">Art. 2</span>
                        <h4 class="font-display font-bold text-2xl md:text-5xl uppercase group-hover:text-melon transition-colors pr-4">Gourmet Egoísta</h4>
                    </div>
                    <span class="text-3xl md:text-4xl font-light transform transition-transform duration-300 flex-shrink-0 group-hover:rotate-45">+</span>
                </button>
                <div class="accordion-content">
                    <div class="pb-8 md:pb-12 text-base md:text-xl font-light opacity-80 leading-relaxed max-w-2xl ml-auto">
                        <p class="mb-4 md:mb-6">
                            No lo hagas por complacerla (actitud de sirviente). Hazlo porque eres un depravado que disfruta del festín. La diferencia entre un "buen chico" y un "monstruo sexual" es el egoísmo virtuoso.
                        </p>
                        <p>
                            <strong>El Veredicto de Pike:</strong> Cómete la fruta con la voracidad de un náufrago. Mánchate. Haz ruido. Que ella sienta que es tu juguete, no tu jefa.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Item 3 -->
            <div class="accordion-item border-b border-cream/30 group">
                <button class="w-full py-8 md:py-12 flex justify-between items-center text-left interactable focus:outline-none">
                     <div class="flex flex-col md:flex-row md:items-center">
                        <span class="font-serif italic text-melon text-lg md:text-2xl mb-2 md:mb-0 md:mr-4">Art. 3</span>
                        <h4 class="font-display font-bold text-2xl md:text-5xl uppercase group-hover:text-melon transition-colors pr-4">Programación Neurolingüística</h4>
                    </div>
                    <span class="text-3xl md:text-4xl font-light transform transition-transform duration-300 flex-shrink-0 group-hover:rotate-45">+</span>
                </button>
                <div class="accordion-content">
                    <div class="pb-8 md:pb-12 text-base md:text-xl font-light opacity-80 leading-relaxed max-w-2xl ml-auto">
                        <p class="mb-4 md:mb-6">
                            El marco de la relación nace en la cama. Si dictas sentencia bajo las sábanas, ella acatará el fallo en la cocina. El dominio sexual reconfigura la jerarquía emocional.
                        </p>
                        <p>
                            <strong>El Veredicto de Pike:</strong> Haz que repita tus palabras mientras la llevas al límite. Ahí es donde se firma el contrato de lealtad.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Item 4 -->
            <div class="accordion-item border-b border-cream/30 group">
                <button class="w-full py-8 md:py-12 flex justify-between items-center text-left interactable focus:outline-none">
                     <div class="flex flex-col md:flex-row md:items-center">
                        <span class="font-serif italic text-melon text-lg md:text-2xl mb-2 md:mb-0 md:mr-4">Art. 4</span>
                        <h4 class="font-display font-bold text-2xl md:text-5xl uppercase group-hover:text-melon transition-colors pr-4">El fantasma del Ex</h4>
                    </div>
                    <span class="text-3xl md:text-4xl font-light transform transition-transform duration-300 flex-shrink-0 group-hover:rotate-45">+</span>
                </button>
                <div class="accordion-content">
                    <div class="pb-8 md:pb-12 text-base md:text-xl font-light opacity-80 leading-relaxed max-w-2xl ml-auto">
                        <p class="mb-4 md:mb-6">
                            ¿Por qué vuelve con el ex tóxico? Porque el ex la hizo sentir cosas que tú, con tus velas y tu "sexo vainilla", no puedes ni imaginar. 
                        </p>
                        <p>
                            <strong>El Veredicto de Pike:</strong> Conviértete en la experiencia que ninguna otra relación futura pueda igualar. Sé el estándar imposible de superar.
                        </p>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- CTA / MÉTODO -->
    <section id="metodo" class="py-20 md:py-32 px-5 md:px-12 flex flex-col items-center justify-center min-h-[70vh] md:min-h-[80vh] bg-cream relative overflow-hidden">
        <div class="absolute top-0 right-0 w-full h-full bg-grid-black/[0.05]"></div>
        <div class="absolute w-[300px] md:w-[600px] h-[300px] md:h-[600px] bg-melon rounded-full blur-[100px] md:blur-[150px] opacity-20 animate-pulse"></div>

        <div class="z-10 text-center max-w-5xl reveal-text w-full">
            <h2 class="font-display font-black text-4xl md:text-8xl uppercase mb-6 md:mb-8 leading-tight break-words hyphens-auto">
                ¿Te atreves a<br>entrar en la <span class="text-transparent bg-clip-text bg-gradient-to-r from-melon to-blood block md:inline mt-2 md:mt-0">trastienda?</span>
            </h2>
            <p class="font-serif italic text-lg md:text-3xl mb-8 md:mb-12 text-gray-700 px-4">
                Deja de ser un opositor a la vida. Empieza a ejercer.
            </p>
            
            <a href="#" class="interactable relative inline-block group w-full md:w-auto px-4 md:px-0">
                <span class="relative z-10 block w-full md:w-auto px-8 md:px-12 py-4 md:py-6 bg-black text-cream font-display font-bold text-lg md:text-2xl uppercase tracking-wider overflow-hidden border-2 border-transparent group-hover:border-black group-hover:text-black transition-colors duration-300">
                    Solicitar Iniciación
                </span>
                <div class="absolute inset-0 bg-melon transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-300 ease-out z-0"></div>
            </a>
            
            <p class="mt-6 md:mt-8 text-xs md:text-sm font-mono opacity-50 uppercase tracking-widest px-4">
                * Acceso restringido. Solo para quienes están listos para mancharse.
            </p>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-black text-cream px-5 md:px-12 py-16 md:py-24 border-t border-gray-800">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
            <div class="overflow-hidden">
                <a href="mailto:confesiones@pike.com" class="interactable font-display font-bold text-2xl md:text-6xl hover:text-melon transition-colors break-words block">
                    confesiones@pike.com
                </a>
            </div>
            <div class="flex flex-col justify-end md:items-end font-serif italic text-lg md:text-xl">
                <p>La Frutería de Pike.</p>
                <p>Calle del Pecado Original, S/N.</p>
                <div class="mt-6 md:mt-8 font-mono text-xs text-gray-500 uppercase">
                    © 2024 Pike. Todos los derechos reservados (y juzgados).
                </div>
            </div>
        </div>
        <div class="mt-16 md:mt-24 text-[18vw] md:text-[15vw] leading-none font-display font-bold text-gray-900 select-none text-center">
            PIKE
        </div>
    </footer>

    <!-- JS -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cursor = document.getElementById('cursor');
            const interactables = document.querySelectorAll('.interactable');
            const revealElements = document.querySelectorAll('.reveal-text');
            const accordions = document.querySelectorAll('.accordion-item');

            // 1. CUSTOM CURSOR LOGIC 
            document.addEventListener('mousemove', (e) => {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            });

            interactables.forEach(el => {
                el.addEventListener('mouseenter', () => cursor.classList.add('hovered'));
                el.addEventListener('mouseleave', () => cursor.classList.remove('hovered'));
            });

            // 2. INTERSECTION OBSERVER FOR REVEALS
            const observerOptions = {
                threshold: 0.1,
                rootMargin: "0px 0px -30px 0px"
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                    }
                });
            }, observerOptions);

            revealElements.forEach(el => observer.observe(el));

            // 3. ACCORDION LOGIC
            accordions.forEach(item => {
                const btn = item.querySelector('button');
                const content = item.querySelector('.accordion-content');
                const icon = btn.querySelector('span:last-child');
                const title = btn.querySelector('h4');

                btn.addEventListener('click', () => {
                    // Close all others
                    accordions.forEach(otherItem => {
                        if (otherItem !== item) {
                            otherItem.querySelector('.accordion-content').style.maxHeight = null;
                            const otherIcon = otherItem.querySelector('button span:last-child');
                            const otherTitle = otherItem.querySelector('h4');
                            if(otherIcon) otherIcon.style.transform = 'rotate(0deg)';
                            if(otherTitle) otherTitle.classList.remove('text-melon');
                        }
                    });

                    // Toggle current
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        if(icon) icon.style.transform = 'rotate(0deg)';
                        if(title) title.classList.remove('text-melon');
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        if(icon) icon.style.transform = 'rotate(45deg)';
                        if(title) title.classList.add('text-melon');
                    }
                });
            });

            // 4. PARALLAX EFFECT ON SCROLL
            window.addEventListener('scroll', () => {
                const scrolled = window.scrollY;
                const marquee = document.querySelector('.marquee-container');
                if(marquee) {
                    marquee.style.transform = `translateX(${scrolled * -0.1}px)`;
                }
            });

            /* =========================================================
               5. CHRISTMAS MODE LOGIC (MOBILE EXCLUSIVE)
               ========================================================= */
            const xmasToggle = document.getElementById('xmas-toggle');
            const audioBtn = document.getElementById('audio-btn');
            const bgMusic = document.getElementById('bg-music');
            const heroImg = document.getElementById('mobile-hero-img');
            const heroContainer = document.getElementById('mobile-hero-container');
            
            let isChristmas = false;
            let heroVideo = null; // We create this dynamically
            let snowCanvas = null;
            let snowCtx = null;
            let snowAnimationFrame = null;

            // --- Ash/Snow Class ---
            class AshSnow {
                constructor(canvasWidth, canvasHeight) {
                    this.x = Math.random() * canvasWidth;
                    this.y = Math.random() * canvasHeight;
                    // Chaotic movement: not just falling straight
                    this.speedY = (Math.random() * 2) + 0.5;
                    this.speedX = (Math.random() * 1) - 0.5;
                    this.size = Math.random() * 3 + 1; // Small ash particles
                    this.opacity = Math.random() * 0.5 + 0.2;
                }

                update(canvasWidth, canvasHeight) {
                    this.y += this.speedY;
                    this.x += this.speedX + (Math.random() - 0.5) * 0.5; // Jitter

                    if (this.y > canvasHeight) {
                        this.y = 0;
                        this.x = Math.random() * canvasWidth;
                    }
                }

                draw(ctx) {
                    ctx.fillStyle = `rgba(242, 240, 235, ${this.opacity})`; // Cream color
                    // Randomly make some particles melon for "sparks"
                    if(Math.random() > 0.98) ctx.fillStyle = `rgba(255, 107, 53, ${this.opacity})`; 
                    
                    ctx.fillRect(this.x, this.y, this.size, this.size); // Rectangles fit brutalism better than circles
                }
            }

            let particles = [];

            function initSnow() {
                if(!snowCanvas) {
                    snowCanvas = document.createElement('canvas');
                    snowCanvas.id = 'snow-canvas';
                    document.body.appendChild(snowCanvas);
                    snowCtx = snowCanvas.getContext('2d');
                    
                    const resize = () => {
                        snowCanvas.width = window.innerWidth;
                        snowCanvas.height = window.innerHeight;
                    };
                    window.addEventListener('resize', resize);
                    resize();
                }
                
                // Reset particles
                particles = [];
                const particleCount = window.innerWidth < 768 ? 80 : 150; // Optimization for mobile
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new AshSnow(snowCanvas.width, snowCanvas.height));
                }
                
                snowCanvas.classList.add('active');
                animateSnow();
            }

            function animateSnow() {
                if (!isChristmas) return;
                
                snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
                
                particles.forEach(p => {
                    p.update(snowCanvas.width, snowCanvas.height);
                    p.draw(snowCtx);
                });
                
                snowAnimationFrame = requestAnimationFrame(animateSnow);
            }

            function stopSnow() {
                if(snowCanvas) snowCanvas.classList.remove('active');
                cancelAnimationFrame(snowAnimationFrame);
            }

            // --- Toggle Logic ---
            xmasToggle.addEventListener('click', () => {
                isChristmas = !isChristmas;

                if (isChristmas) {
                    // Activate Mode
                    xmasToggle.textContent = "✖ RESTAURAR";
                    xmasToggle.classList.replace('bg-melon', 'bg-black');
                    xmasToggle.classList.replace('text-black', 'text-melon');
                    xmasToggle.classList.add('border-melon');

                    // Show Audio Btn
                    audioBtn.classList.remove('hidden');

                    // Swap Image for Video
                    heroImg.style.opacity = '0';
                    setTimeout(() => {
                        heroImg.style.display = 'none';
                        if (!heroVideo) {
                            heroVideo = document.createElement('video');
                            heroVideo.src = 'pike-boss.webm';
                            heroVideo.muted = true;
                            heroVideo.loop = true;
                            heroVideo.autoplay = true;
                            heroVideo.setAttribute('playsinline', ''); // Essential for iOS
                            heroVideo.classList.add('absolute', 'inset-0', 'w-full', 'h-full', 'object-cover');
                            heroVideo.style.objectPosition = 'center 20%';
                            heroContainer.appendChild(heroVideo);
                        } else {
                            heroVideo.style.display = 'block';
                            heroVideo.play();
                        }
                    }, 500); // Wait for fade out

                    // Start Snow
                    initSnow();

                } else {
                    // Deactivate Mode
                    xmasToggle.textContent = "❄ SOLSTICIO PAGANO";
                    xmasToggle.classList.replace('bg-black', 'bg-melon');
                    xmasToggle.classList.replace('text-melon', 'text-black');
                    xmasToggle.classList.remove('border-melon');

                    // Hide Audio Btn & Stop Music
                    audioBtn.classList.add('hidden');
                    bgMusic.pause();
                    audioBtn.textContent = "♪ SONIDO";

                    // Revert Image
                    if (heroVideo) {
                        heroVideo.pause();
                        heroVideo.style.display = 'none';
                    }
                    heroImg.style.display = 'block';
                    // Small delay to allow display block to apply before opacity transition
                    requestAnimationFrame(() => {
                        heroImg.style.opacity = '1';
                    });

                    // Stop Snow
                    stopSnow();
                }
            });

            // --- Audio Logic ---
            audioBtn.addEventListener('click', () => {
                if (bgMusic.paused) {
                    bgMusic.play().then(() => {
                        audioBtn.textContent = "♪ PAUSAR";
                    }).catch(err => {
                        console.error("Audio playback blocked", err);
                    });
                } else {
                    bgMusic.pause();
                    audioBtn.textContent = "♪ SONIDO";
                }
            });
        });
    </script>
</body>
</html>